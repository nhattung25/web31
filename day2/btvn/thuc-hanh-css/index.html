<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phân tích nghiệp vụ: Action - Event - Status</title>

    <link
      rel="shortcut icon"
      href="/day2/btvn/thuc-hanh-css/images/favicon.ico.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="/day2/btvn/thuc-hanh-css/css/style.css" />
  </head>

  <body>
    <div class="background">
      <div>
        <!-- Thanh menu -->
        <div class="container">
          <a class="linktech" href="https://techmaster.vn/">TechMaster</a>

          <div>
            <a
              class="link"
              href="https://techmaster.vn/san-pham-hoc-vien?page=1"
              >SẢN PHẨM HỌC VIÊN</a
            >

            <a
              class="link"
              href="https://techmaster.vn/trungtam/lich-khai-giang"
              >KHAI GIẢNG</a
            >

            <a class="link" href="https://techmaster.vn/posts">BLOG</a>

            <a class="link" href="https://techmaster.vn/trai-nghiem"
              >TRẢI NGHIỆM</a
            >

            <a class="link" href="https://job.techmaster.vn/viec-lam"
              >VIỆC LÀM</a
            >
            <a class="link" href="">KHÓA HỌC</a>
            <!-- Drop Menu -->

            <div class="dropdown">
              <button class="dropdown_button">CHÚNG TÔI</button>
              <div class="dropdown_content">
                <a href="https://techmaster.vn/trungtam/trung-tam">Trung tâm</a>
                <a href="https://techmaster.vn/trungtam/quy-dinh-chung"
                  >Quy định chung</a
                >
                <a href="https://techmaster.vn/trungtam/giang-vien"
                  >Giảng viên</a
                >
                <a href="https://techmaster.vn/trungtam/huong-dan-mua-khoa-hoc"
                  >Hướng dẫn mua khóa học</a
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Thanh dẫn hương thư mục -->
        <br />
        <a class="folder" href="https://techmaster.vn/">Trang chủ</a>&nbsp;
        >&nbsp;
        <a class="folder" href="https://techmaster.vn/posts">Blog</a>&nbsp;
        >&nbsp;
        <a class="folder" href="http://127.0.0.1:5500/index.html"
          >Phân tích nghiệp vụ: Action - Event - Status</a
        >
      </div>

      <!-- Nội dung chính trang web -->
      <div class="content">
        <!-- Thân bài viết bên trái -->
        <div class="leftblock">
          <h1 class="heading">Phân tích nghiệp vụ: Action - Event - Status</h1>
          <p>14 tháng 10, 2021 - 679 lượt xem</p>

          <div>
            <button type="button" onclick="dieu_huong()">
              <b>Design Pattern</b>
            </button>

            <script>
              function dieu_huong() {
                location.assign(
                  "https://techmaster.vn/posts?keyword=&category=814"
                );
              }
            </script>
          </div>
          <br />

          <hr class="horline" />

          <hr class="verline1" />

          <blockquote>
            Gần đây tôi tham gia thiết kế một dự án. Các thành viên trong nhóm
            cứ tạo những bảng có trường status, rồi thêm trường create_date và
            modified_date nhìn rất giống trong sách. Nhưng họ không hiểu rõ khác
            biệt giữa Action (Hành động) - Event (Sự kiện) - Status (Trạng thái)
            trong phân tích thiết kế phần mềm. Kết quả là bảng nhiều, cột nhiều
            nhưng không xử lý hết yêu cầu nghiệp vụ. Bàn tới bàn lui, mà không
            giải quyết được nghiệp vụ.
          </blockquote>

          <h2>Action là động từ, Event là danh từ, còn Status là tính từ</h2>

          <p>
            Action: Khách hàng đặt hàng - customer orders an item Event: Bản ghi
            đơn hàng được tạo ra - order record is created Status: Trạng thái
            của đơn hàng là "được tạo" - order status is "created" Khi chúng ta
            lấy yêu cầu từ khách hàng, tạo user story thì khách hàng thường mô
            tả: Ai đó làm gì? Ví dụ:
          </p>

          <hr class="verline2" />

          <blockquote>
            Khách hàng đăng nhập -> khách hàng truy vấn tài khoản -> khách hàng
            nhập tài khoản cần chuyển khoản -> khách hàng chọn ngân hàng ->
            khách hàng gõ số tiền cần chuyển -> Hệ thống gửi mã OTP -> khách
            hàng nhập xác nhận -> tiến hành chuyển khoản -> Hệ thống gửi biên
            lai chuyển khoản.
          </blockquote>

          <ul class="liststyle">
            <li>Người tác động lên một đối tượng - User does some thing</li>
            <li>
              Hệ thống (phần mềm) thì thực hiện tác vụ - System run a task
            </li>
          </ul>

          <blockquote>
            Nếu bạn sử CSDL quan hệ bạn có thể lưu lại từng dòng action theo
            thời gian. Tuy nhiên sau một hành động có ít nhất 2 sự kiện: thành
            công hoặc thất bại. Nếu bạn chỉ quan tâm đến sự kiện hữu ích với hệ
            thống thì bạn nên dùng event.
          </blockquote>

          <h2>
            Liệt kê đủ sự kiện / tác vụ phát sinh sau một hành động ban đầu.
          </h2>

          <p>
            Khi khách hàng đặt mua một mặt hàng ~ action: customer orders an
            item. Có những sự kiện và tác vụ phát sinh:
          </p>

          <ol class="liststyle">
            <li>Event: Đơn hàng được tạo ra ~ order is created.</li>

            <li>
              Action: Hệ thống kho kiểm tra số lượng hàng tồn kho - inventory
              check item availability. Hoặc với shop nhỏ, chỉ cần truy vấn số
              lượng hàng có sẵn.
            </li>

            <li>
              Nếu mặt hàng ở trạng thái hết hàng (status out of stock) -->
              action: hệ thống tự động đặt mua bổ xung hàng hoặc trả về thông
              báo hết hàng hoặc email thông báo cho phòng đặt hàng.
            </li>
          </ol>

          <p>
            Liệt kê đủ thì cơ bản hiểu được yêu cầu nghiệp vụ. Nhưng việc chúng
            ta hiện thực hoá nghiệp vụ như thế nào xin mời đọc tiếp.
          </p>

          <h2>CSDL thần thánh làm được những gì?</h2>
          <p>
            Hồi mới lập trình, khi insert một bản ghi vào CSDL rồi lại truy vấn
            được ra, chế biến thành các báo cáo khác nhau, tôi vô cùng phân
            khích cảm giác mãn nguyện với phần mềm mình viết. Nhưng càng dùng
            thấy nó càng thiếu sót nhiều trường hợp, thậm chí dữ liệu sai lệch.
            Mà rõ ràng là khi phân tích nghiệp vụ đã liệt kê chi tiết. <br />
            <br />

            Một lỗi căn bản tôi thường mắc là chỉ lưu trạng thái, giá trị cuối
            cùng của một sự kiện. Ví dụ khách hàng mua một đôi giày ngày
            1/10/2021, lúc đó giá là 100VND. Nhưng đến ngày 10/10, giá tăng lên
            110VND. Cuối tháng hệ thống cứ báo là đơn hàng này thu thiếu 10VND.
            <br />
            <br />

            Khách hàng mua 1 sản phẩm không được giảm giá, nhưng mua 2 mặt hàng
            được giảm 500VND. Nhưng mua xong, họ hoàn lại 1. Nếu chỉ lưu trạng
            thái cuối cùng đơn hàng là một sản phẩm. Chúng ta lại thu thiếu
            500VND!
          </p>

          <q
            >Sai lầm lớn nhất của lập trình viên CSDL chỉ lưu trạng thái
            (status) cuối cùng mà bỏ qua các hành động (action) - sự kiện
            (event) dẫn đến trạng thái đó.
          </q>
          <br />

          <hr class="verline3" />

          <blockquote>
            Trong software engineering có một kỹ thuật gọi là Event Sourcing
            luôn lưu sự kiện chân thực nhất theo thực tế đã xảy ra, không sửa
            đổi, không xoá. Để đơn giản hoá, Action ban đầu cũng coi là một sự
            kiện ban đầu (initial event hay starting event). Kết thúc một event,
            một hay nhiều đối tượng thay đổi trạng thái. Lưu hay không lưu CSDL,
            tuỳ thuộc nhu cầu báo cáo. Nếu không có hiệu ứng phụ, sai lệch số
            liệu, hệ thống chỉ cần chạy lại play back lại chuỗi event ghi trung
            thực những gì đã diễn ra thì có được trạng thái cuối cùng.
          </blockquote>

          <h2>
            Lưu lại chân thực các sự kiện đã diễn ra - store immutable events
          </h2>
          <p>
            Nếu bạn thiết kế một hệ thống lớn, microservice phức tạp. Ở đó các
            microservice trao đổi với nhau qua những event, message thi bạn cần
            phải đọc khá nhiều pattern này nọ, phức tạp. Bài viết này dành cho
            những bạn sinh viên đang học nghề, code với một CSDL:
          </p>

          <ul class="liststyle">
            <li>
              Hãy tạo bảng lưu sự kiện:
              <span class="para"
                >order_event, member_event, inventory_event</span
              >
            </li>

            <li>
              Tạo bảng lưu giá trị theo thời gian ví dụ lịch sử giá mặt hàng.
              Mỗi dòng trong đơn hàng, tham chiếu đến giá tại thời điểm đặt
              hàng. Thay đổi giá hay tạo khuyến mại thì tạo bản ghi lưu giá mới,
              không sửa trực tiếp vào bản ghi cũ.
            </li>
          </ul>

          <p>
            Khi lưu sự kiện theo thời gian, đôi khi chúng ta cần lưu cả trạng
            thái kết quả của sự kiện đó. Vậy các bạn cần liệt kê các trạng thái
            có thể xảy ra.
          </p>
          <img
            src="/day2/btvn/thuc-hanh-css/images/1.png"
            alt="Không thể hiển thị"
          />

          <p>Liệt kê các sự kiện (event) một lớp học ở Techmaster:</p>

          <ol class="liststyle">
            <li>
              Giáo vụ lên lịch khai giảng một lớp học - Staff schedules a class
            </li>
            <li>
              Giáo vụ điều chỉnh lịch khai giảng - Staff reschedules a class
            </li>
            <li>
              Giáo vụ thu học phí và chuyển sinh viên vào lớp - Staff adds
              student to class
            </li>
            <li>
              Giáo vụ chọn giảng viên dạy lớp - Staff assigns teacher to class
            </li>
            <li>Giáo vụ khai giảng một lớp học - Staff opens class</li>
            <li>
              Giáo vụ đánh dấu một lớp học đã hoàn tất - Staff marks class
              completed
            </li>
            <li>
              Giáo vụ ghép hai lớp học lại thành một - Staff merges two classes
              into one
            </li>
            <li>Giáo vụ huỷ lịch khai giảng - Staff cancels a class</li>
            <li>
              Giáo vụ dừng một lớp học đang diễn ra - Staff aborts a class
            </li>
            <li>
              Giáo vụ rút học viên ra khỏi lớp - Staff moves a student out class
            </li>
          </ol>

          <p>Liệt kê các trạng thái (status) một lớp học:</p>

          <ol class="liststyle">
            <li><span class="para">scheduled</span>: lập lịch để khai giảng</li>
            <li><span class="para">active</span>: đang học</li>
            <li><span class="para">canceled</span>: huỷ khi chưa diễn ra</li>
            <li><span class="para">aborted</span> : dừng giữa chừng</li>
            <li>
              <span class="para">merged</span> : bị ghép chuyển sang lớp khác
            </li>
            <li><span class="para">completed</span> : hoàn tất</li>
          </ol>

          <p>
            Rõ ràng không phải sự kiện nào cũng thay đổi trạng thái của lớp học,
            hoặc có lúc thay đổi có lúc không.
          </p>

          <ul class="liststyle">
            <li>
              Ví dụ 1: thêm sinh viên vào lớp, không chuyển lớp từ
              <span class="para">scheduled</span> sang
              <span class="para">active</span>.
            </li>
            <li>
              Ví dụ 2: file được tạo ra trong ổ cứng (file is created) là sự
              kiện tác động lên ổ cứng. Ổ cứng chuyển sang trạng thái đầy
              <span class="para"> disk full </span> sau khi rất nhiều file kích
              thước khủng tạo ra.
            </li>
          </ul>

          <img
            src="/day2/btvn/thuc-hanh-css/images/2.png"
            alt="Không thể hiển thị"
          />

          <h2>Tóm lại</h2>

          <ol class="liststyle">
            <li>Cần phiên biệt rõ Action - Event - Status.</li>
            <li>
              Đừng chỉ lưu trạng thái cuối cùng, mà lưu chuỗi các sự kiện theo
              đúng trình tự thực tế diễn ra. Không sửa, xoá sự kiện chân thực,
              chỉ tạo thêm: only append immutable event.
            </li>
            <li>Cần liệt kê đầy đủ các sự kiện - trạng thái.</li>
            <li>
              Vẽ lược đồ chuyển đổi trạng thái để hình dung và lập trình đúng.
            </li>
            <li>
              Đừng lưu trường <span class="para">created_date</span> và
              <span class="para">modified_date</span> cùng một bảng. Hãy tạo
              bảng lưu sự kiện chỉ với created_date và không sửa đổi nó. Xem mục
              2.
            </li>
            <li>
              Nếu của một sự kiện sẽ broad cast sang nhiều microservice khác
              nhau hãy dùng global unique id nhưng sắp xếp được theo thời gian.
              Còn nếu <span class="para">event_id</span> chỉ là sự kiện trong
              một hệ thống nhỏ monolithic, single database, bạn có thẻ
            </li>
          </ol>
          <h1>Bình luận</h1>
          <br /><br />

          <table>
            <tr>
              <td>
                <textarea
                  name="binhluan"
                  id="binhluan"
                  cols="120"
                  rows="11"
                ></textarea>
              </td>
            </tr>
          </table>

          <button
            type="button"
            onclick="#"
            style="
              background-color: rgb(30, 31, 73);
              color: white;
              height: 35px;
              width: 120px;
              border: none;
            "
          >
            <b>BÌNH LUẬN</b>
          </button>
        </div>

        <!-- Bài viết phụ bên phải -->
        <div
          style="
            width: 20%;
            padding-top: 40px;
            float: right;
            padding-right: 40px;
          "
        >
          <img
            style="float: left; padding-left: 20px"
            src="/day2/btvn/thuc-hanh-css/images/TMC.png"
            alt="Không thể hiển thị"
          />
          <a
            class="linktmc"
            href="https://techmaster.vn/author/36/trinh-minh-cuong"
            target="_blank"
          >
            <b>Trịnh Minh Cường </b> <br />
            317 bài viết
          </a>

          <img
            style="padding-top: 40px"
            src="/day2/btvn/thuc-hanh-css/images/daumuc.png"
            alt="Không thể hiển thị"
          />
          <p>Action là động từ, Event là danh từ, còn Status là tính từ</p>
          <p>
            Liệt kê đủ sự kiện / tác vụ phát sinh sau một hành động ban đầu.
          </p>
          <p>CSDL thần thánh làm được những gì?</p>
          <p>
            Lưu lại chân thực các sự kiện đã diễn ra - store immutable events
          </p>
          <p>Tóm lại</p>

          <img
            style="padding-top: 40px"
            src="/day2/btvn/thuc-hanh-css/images/daumuc2.png"
            alt="Không thể hiển thị"
          />
          <br />
          <br />
          <a
            class="link2"
            href="https://techmaster.vn/posts/37317/dung-leetcode-de-luyen-ky-nang-lap-trinh"
            target="_blank"
            >Dùng LeetCode để luyện kỹ năng lập trình</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/posts/37317/dung-leetcode-de-luyen-ky-nang-lap-trinh"
            target="_blank"
            >Lecturer, Trainer, Tutor, Coach, Mentor khác nhau ở những điểm
            gì?</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/posts/37163/series-day-tre-em-lap-trinh-p2"
            target="_blank"
            >Series: Dạy trẻ em lập trình - P2</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/posts/37156/series-day-tre-em-lap-trinh-p1"
            target="_blank"
            >Series: Dạy trẻ em lập trình - P1</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/posts/37107/cai-dat-moi-truong-lap-trinh-nginx-php-bang-docker-compose"
            target="_blank"
            >Cài đặt môi trường lập trình Nginx - PHP bằng Docker Compose</a
          >
          <br /><br />

          <img
            style="padding-top: 40px"
            src="/day2/btvn/thuc-hanh-css/images/daumuc3.png"
            alt="Không thể hiển thị"
          />
          <br /><br />
          <a
            class="link2"
            href="https://techmaster.vn/course-detail/08r/khoa-hoc-kubernetes-can-ban-qua-cac-vi-du"
            target="_blank"
            >Khoá học Kubernetes căn bản qua các ví dụ</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/course-detail/0fu/git-can-ban-den-nang-cao"
            target="_blank"
            >Git căn bản đến nâng cao</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/course-detail/1y2/python-co-ban-cho-nghe-phan-tich-du-lieu"
            target="_blank"
            >PYTHON cơ bản cho nghề PHÂN TÍCH DỮ LIỆU</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/course-detail/25487/web-co-ban-html5-css3-va-javascript-online"
            target="_blank"
            >Web cơ bản HTML5, CSS3 và Javascript Online</a
          >

          <a
            class="link2"
            href="https://techmaster.vn/course-detail/25518/web-frontend-nang-cao-voi-react"
            target="_blank"
            >Web Frontend nâng cao với React</a
          >
          <br /><br />
        </div>
      </div>
    </div>
  </body>
</html>
